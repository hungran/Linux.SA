# 1.Booting and SMD
## Boot Process Overview
  1. Find
  2. Load
  3. Running Bootstrapp code
  4. Running startup script -> system deamons
 
 <img src="https://imgur.com/XjpWlE0.jpg">
 
 *Note*:  
	`Before the system is fully booted, filesystems must be checked and mounted and system
daemons started. These procedures are managed by a series of shell scripts (sometimes called
"init scripts") or unit files that are run in sequence by **init** or parsed by **systemd**.`

## 1.2 System Firmware
	- Device on motherboard such as SATA, network interface, USB...
## 1.3 BIOS vs UEFI std
 1. BIOS (Basic In / Out System)
	- Traditional PC firmware
	- BIOS relate Legacy BIOS
	- Boot with device starts with MBR (Master Boot Record)
 2. UEFI (or reversion of EFI)
	- use GPT disk partition (GUID Parition Table)
	- use FAT filesystems
	- use EFI System Part (ESP) at boot time
	- ESP available be mounted, read, written maintain by OS
	Note: *Not to run MBR-specific admin tool on GPT disk because BIOS system can't see the full GPT part table.
	- normal path
	`/efi/boot/bootx64.efi`
	or on ubuntu
	`/efi/ubuntu/grubx64.efi`
	- show config boot
	`efibootmgr -v`
## 1.4 Boot Loader
 - eg: GRUB
## 1.5 GRUB (Grand unified boot loader)
 - Original GRUB: GRUB Legacy
 - Extra-crispy GRUB 2 is **current standard** (for Ubuntu and RHEL)
 - Available to boot FreeBSD (UNIX) 
 - Stored system's NVRAM
 - It came from regular text file **grub.cfg**.
 Path 
 `/boot/grub` 
 or in RHEL and CentOS
 `/boot/grub2`
 - Available to create by yourself
 - Path
 `/etc/default/grub`
 - Modify or configure by **grub2-mkconfig**
 -GRUB config options **/etc/default/grub`.
 
 |shell               var|    Contents or function   |
 |-----------------------|---------------------------|
 |GRUB_BACKGROUND| Background image **must be .png, .tga, .jpg or .jpeg file**
 |GRUB_CMDLINE_LINUX| Kernel parameters to add |
 |GRUB_DEFAULT| Number or title of the menu entry|
 |GRUB_DISABLE_RECOVERY| Prevent the generation of recovery mode entries|
 |GRUB_PRELOAD_MODULES| List of GRUB modules to be loaded as early as possible|
 |GRUB_TIMEOUT| Second to display the boot menu before autoboot|
 
 - After modified, run `update-grub` or `grub2-mkconfig` 
 
 - Boot command:
 
 | CMD | Function |
 | --- | --- |
 | boot | Boot the system from specified kernel image |
 | help | Gets interactive help for a command |
 | linux | Loads a Linux kernel |
 | reboot | Reboots the system |
 | search | Searches devices by file, filesystem label, or UUID **need to be clear later**
 | usb | Tests USB support |
 
 - Linux kernel options -> * sepcify path to the* **init** or **systemd** *
## 1.6 FreeBSD boot process
 - **loader**
 - BIOS path called **boot0** instead **GRUB** in 
	- available adjusting with `boot0cfg` command
 - UEFI path 
	- path: `/boot/bootx64.efi`
 - loader configuration
 - loader command
## 1.7 System Management Daeamons (quản lý hệ thống background process)
###Tổng quan:
 - Tiến trình này được khởi chạy ngay khi kernel được load thành công
 - Chạy tự phát bởi kernel khởi động ngẫu nhiên, mỗi tiến trình mới được tạo ra từ tiến trình hiện có
 - Có thể list danh sách bằng lệnh `ps`
 - Là thành phần quan trọng để khởi tạo hệ thống
 - Chương trình đầu tiên được chạy có Process ID (PID) là 1 hay còn gọi tên là **init**
 - **init** đóng vai trò kích hoạt các file cấu hình hệ thống
  init:
	- Vai trò chính của init là tạo ra các process bằng chạy các chương trình được quy định
	- 3 mode init:
		1. Single-user mode: 
		2. Multi-user mode
		3. Server mode
	- **init** được thay thế bằng **systemd**
## 1.8 systemd chi tiết
 - systemd được chạy dưới nền và được cấu hình thành 1 file gọi là **unit**
 - Các thành phần của `systemd`:
	- `systemctl` quản lý trạng thái (bắt đầu chạy, dừng, khởi động lại)
	- `journald`  log hệ thống
	- `logind` quản lý truy cập của user
	- `networkd` quản lý kết nối mạng
	- `timedated` quản lý thời gian
	- `udev` quản lý thiết bị và firmware
	
 -  **unit** bao gồm 12 loại
`	- service (các file quản lý hoạt động của 1 số chương trình)
	- socket (quản lý các kết nối)
	- device (quản lý thiết bị)
	- mount (gắn thiết bị)
	- automount (tự đống gắn thiết bị)
	- swap (vùng không gian bộ nhớ trên đĩa cứng)
	- target (quản lý tạo liên kết)
	- path (quản lý các đường dẫn)
	- timer (dùng cho cron-job để lập lịch)
	- snapshot (sao lưu)
	- slice (dùng cho quản lý tiến trình)
	- scope (quy định không gian hoạt động) `
 - **service trong systemd **
	- khởi động khi bật máy
	- chạy ở nền
	- được cấu hình ở các file riêng
	- quản lý bởi lệnh `systemctl`
			`start` : bật service
			`stop`	: tắt service
			`restart`
				eg: `$  sudo systemctl restart firewalld`
				